<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    <title>Earth Tuner - Live World Radio 3D</title>
    <meta name="description" content="Jelajahi dan dengarkan ribuan stasiun radio langsung dari seluruh dunia melalui visualisasi Globe 3D interaktif. Pengalaman audio visual imersif.">
    <meta name="keywords" content="radio, world radio, 3d globe, three.js, music, live streaming, earth tuner, radio garden alternative">
    <meta name="author" content="Azfaribn">
    <meta name="theme-color" content="#050505">

    <meta property="og:type" content="website">
    <meta property="og:url" content="https://earth-tuner.vercel.app/"> <meta property="og:title" content="Earth Tuner - Jelajahi Radio Dunia 3D">
    <meta property="og:description" content="Putar bola dunia, pilih stasiun, dan dengarkan siaran langsung dari berbagai negara secara realtime.">
    <meta property="og:image" content="https://images.unsplash.com/photo-1451187580459-43490279c0fa?q=80&w=1200&auto=format&fit=crop">

    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:title" content="Earth Tuner - Live World Radio 3D">
    <meta property="twitter:description" content="Jelajahi dan dengarkan ribuan stasiun radio langsung dari seluruh dunia melalui visualisasi Globe 3D interaktif.">
    
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üåç</text></svg>">

    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        body { margin: 0; overflow: hidden; background-color: #050505; color: white; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        #canvas-container { width: 100vw; height: 100vh; position: absolute; top: 0; left: 0; z-index: 1; }
        #ui-layer { position: absolute; z-index: 10; width: 100%; height: 100%; pointer-events: none; }
        
        /* Interactive Elements allow pointer events */
        .interactive { pointer-events: auto; }

        /* Custom Scrollbar for list */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #1a1a1a; }
        ::-webkit-scrollbar-thumb { background: #33bb55; border-radius: 3px; }

        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #34d399;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        .station-dot {
            transition: all 0.3s ease;
        }

        /* Scanline effect for retro feel */
        .scanlines {
            background: linear-gradient(to bottom, rgba(255,255,255,0), rgba(255,255,255,0) 50%, rgba(0,0,0,0.1) 50%, rgba(0,0,0,0.1));
            background-size: 100% 4px;
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            pointer-events: none;
            z-index: 5;
        }
        
        .glass-panel {
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
    </style>
</head>
<body>

    <div id="canvas-container"></div>
    
    <div class="scanlines"></div>

    <div id="ui-layer" class="flex flex-col justify-between p-4">
        
        <div class="flex justify-between items-start">
            <div class="interactive glass-panel p-4 rounded-lg max-w-xs">
                <h1 class="text-2xl font-bold text-green-400 tracking-wider">EARTH TUNER</h1>
                <p class="text-[10px] uppercase tracking-[0.2em] text-green-500/60 font-mono mb-2">Created by Azfaribn</p>
                <p class="text-xs text-gray-300">Jelajahi siaran langsung dari seluruh dunia.</p>
                <div class="mt-2 text-xs text-gray-400">
                    <span class="inline-block w-2 h-2 rounded-full bg-green-500 mr-1 animate-pulse"></span>
                    <span id="station-count">Memuat stasiun...</span>
                </div>
            </div>
            
            <button id="reset-cam" class="interactive glass-panel p-2 rounded-full hover:bg-white/10 transition" title="Reset Camera">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-white"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 12"/></svg>
            </button>
        </div>

        <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 pointer-events-none opacity-20">
            <svg width="100" height="100" viewBox="0 0 100 100">
                <line x1="50" y1="20" x2="50" y2="80" stroke="white" stroke-width="1" />
                <line x1="20" y1="50" x2="80" y2="50" stroke="white" stroke-width="1" />
                <circle cx="50" cy="50" r="30" stroke="white" stroke-width="1" fill="none" />
            </svg>
        </div>

        <div id="player-panel" class="interactive glass-panel rounded-xl p-4 w-full max-w-md mx-auto mb-4 transform translate-y-full transition-transform duration-500 ease-out hidden">
            <div class="flex items-center gap-4">
                <button id="play-btn" class="w-12 h-12 flex items-center justify-center bg-green-500 rounded-full hover:bg-green-400 text-black font-bold shadow-lg shadow-green-500/30 transition transform hover:scale-105">
                    <svg id="icon-play" class="w-5 h-5 ml-1 hidden" fill="currentColor" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
                    <svg id="icon-pause" class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg>
                    <div id="audio-loader" class="loader w-6 h-6 border-2 border-t-black hidden"></div>
                </button>

                <div class="flex-1 overflow-hidden">
                    <h2 id="station-name" class="font-bold text-lg truncate text-white">Station Name</h2>
                    <p id="station-loc" class="text-sm text-green-300 truncate">City, Country</p>
                    <p id="station-tags" class="text-xs text-gray-400 truncate mt-1">Pop, News, Jazz</p>
                </div>

                <div class="flex items-end gap-1 h-8">
                    <div class="w-1 bg-green-500 h-3 animate-[bounce_1s_infinite]"></div>
                    <div class="w-1 bg-green-500 h-6 animate-[bounce_1.2s_infinite]"></div>
                    <div class="w-1 bg-green-500 h-4 animate-[bounce_0.8s_infinite]"></div>
                    <div class="w-1 bg-green-500 h-7 animate-[bounce_1.5s_infinite]"></div>
                </div>
            </div>
            
            <div id="error-msg" class="text-red-400 text-xs mt-2 hidden text-center">
                Gagal memuat stream. Stasiun mungkin offline.
            </div>
        </div>
    </div>

    <div id="start-overlay" class="fixed inset-0 z-50 bg-black flex flex-col items-center justify-center">
        <div class="text-center space-y-6 max-w-md px-6">
            <div class="flex flex-col items-center">
                <h1 class="text-4xl md:text-6xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-green-400 to-blue-500 mb-2">EARTH TUNER</h1>
                <p class="text-[10px] uppercase tracking-[0.2em] text-green-500/60 font-mono">Created by Azfaribn</p>
            </div>
            <p class="text-gray-400">Putar bola dunia. Klik titik hijau. Dengarkan dunia.</p>
            <button id="start-btn" class="px-8 py-3 bg-green-600 hover:bg-green-500 text-white font-bold rounded-full transition transform hover:scale-105 shadow-[0_0_20px_rgba(34,197,94,0.5)]">
                MULAI JELAJAH
            </button>
        </div>
    </div>

    <audio id="radio-player" crossorigin="anonymous"></audio>

    <script type="importmap">
        {
            "imports": {
                "three": "https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js",
                "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/"
            }
        }
    </script>

    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';

        // --- Config ---
        const MAX_STATIONS = 400; // Limit to prevent lag
        const GLOBE_RADIUS = 5;
        const STATION_COLOR = 0x00ff88;
        const STATION_HOVER_COLOR = 0xffffff;

        // --- State ---
        let scene, camera, renderer, controls, globe;
        let stationsData = [];
        let stationMeshes = [];
        let raycaster = new THREE.Raycaster();
        let mouse = new THREE.Vector2();
        let hoveredStation = null;
        let currentStation = null;
        let isPlaying = false;
        
        const audioPlayer = document.getElementById('radio-player');
        
        // --- DOM Elements ---
        const playerPanel = document.getElementById('player-panel');
        const playBtn = document.getElementById('play-btn');
        const iconPlay = document.getElementById('icon-play');
        const iconPause = document.getElementById('icon-pause');
        const audioLoader = document.getElementById('audio-loader');
        const stationNameEl = document.getElementById('station-name');
        const stationLocEl = document.getElementById('station-loc');
        const stationTagsEl = document.getElementById('station-tags');
        const errorMsg = document.getElementById('error-msg');
        const stationCountEl = document.getElementById('station-count');
        const startOverlay = document.getElementById('start-overlay');
        const resetCamBtn = document.getElementById('reset-cam');

        // --- Initialization ---
        document.getElementById('start-btn').addEventListener('click', () => {
            startOverlay.style.opacity = '0';
            setTimeout(() => {
                startOverlay.remove();
                init();
                animate();
                fetchStations();
            }, 500);
        });

        function init() {
            // Scene Setup
            const container = document.getElementById('canvas-container');
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x050505);
            scene.fog = new THREE.FogExp2(0x050505, 0.03);

            // Camera
            camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.z = 18;
            camera.position.y = 8;

            // Renderer
            renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
            container.appendChild(renderer.domElement);

            // Controls
            controls = new OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.05;
            controls.rotateSpeed = 0.6;
            controls.minDistance = 6.5; // Don't go inside earth
            controls.maxDistance = 50;
            controls.autoRotate = true;
            controls.autoRotateSpeed = 0.5;

            // Lights
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.4); // Soft white light
            scene.add(ambientLight);

            const dirLight = new THREE.DirectionalLight(0xffffff, 1.5);
            dirLight.position.set(50, 20, 30);
            scene.add(dirLight);

            // Stars Background
            addStars();

            // The Globe
            createGlobe();

            // Event Listeners
            window.addEventListener('resize', onWindowResize);
            window.addEventListener('mousemove', onMouseMove);
            window.addEventListener('click', onClick);
            window.addEventListener('touchstart', onTouchStart, { passive: false });
            
            // UI Listeners
            playBtn.addEventListener('click', togglePlay);
            resetCamBtn.addEventListener('click', () => {
                controls.reset();
                camera.position.z = 18;
                camera.position.y = 8;
            });
        }

        function createGlobe() {
            // Earth Geometry
            const geometry = new THREE.SphereGeometry(GLOBE_RADIUS, 64, 64);
            
            // Textures
            const textureLoader = new THREE.TextureLoader();
            
            // High res Earth texture
            const earthMap = textureLoader.load('https://unpkg.com/three-globe/example/img/earth-blue-marble.jpg');
            const bumpMap = textureLoader.load('https://unpkg.com/three-globe/example/img/earth-topology.png');

            const material = new THREE.MeshPhongMaterial({
                map: earthMap,
                bumpMap: bumpMap,
                bumpScale: 0.05,
                specular: new THREE.Color(0x111111),
                shininess: 10
            });

            globe = new THREE.Mesh(geometry, material);
            scene.add(globe);

            // Atmosphere Glow
            const atmosphereGeo = new THREE.SphereGeometry(GLOBE_RADIUS + 0.1, 64, 64);
            const atmosphereMat = new THREE.MeshPhongMaterial({
                color: 0x44aaee,
                transparent: true,
                opacity: 0.15,
                side: THREE.BackSide,
                blending: THREE.AdditiveBlending,
            });
            const atmosphere = new THREE.Mesh(atmosphereGeo, atmosphereMat);
            scene.add(atmosphere);
        }

        function addStars() {
            const r = 200;
            const starsGeometry = new THREE.BufferGeometry();
            const starsVertices = [];

            for (let i = 0; i < 2000; i++) {
                const x = THREE.MathUtils.randFloatSpread(r * 2);
                const y = THREE.MathUtils.randFloatSpread(r * 2);
                const z = THREE.MathUtils.randFloatSpread(r * 2);
                starsVertices.push(x, y, z);
            }

            starsGeometry.setAttribute('position', new THREE.Float32BufferAttribute(starsVertices, 3));
            const starsMaterial = new THREE.PointsMaterial({ color: 0x888888, size: 0.7 });
            const starField = new THREE.Points(starsGeometry, starsMaterial);
            scene.add(starField);
        }

        // --- Data Fetching ---
        async function fetchStations() {
            try {
                // Fetch top clicked stations with geo info
                const response = await fetch('https://de1.api.radio-browser.info/json/stations/search?limit=' + MAX_STATIONS + '&has_geo_info=true&order=clickcount&reverse=true&hidebroken=true');
                const data = await response.json();
                
                stationsData = data.filter(s => s.geo_lat && s.geo_long);
                stationCountEl.innerText = `${stationsData.length} Stasiun Aktif`;
                
                plotStations();
            } catch (error) {
                console.error("Error fetching stations:", error);
                stationCountEl.innerText = "Gagal memuat data.";
            }
        }

        // --- Plotting on Globe ---
        function plotStations() {
            // We use a small sphere for each station
            const pointGeo = new THREE.SphereGeometry(0.06, 8, 8);
            const pointMat = new THREE.MeshBasicMaterial({ color: STATION_COLOR });
            
            const group = new THREE.Group();
            
            stationsData.forEach((station, index) => {
                const lat = station.geo_lat;
                const lon = station.geo_long;
                
                const pos = latLongToVector3(lat, lon, GLOBE_RADIUS);
                
                const mesh = new THREE.Mesh(pointGeo, pointMat.clone());
                mesh.position.copy(pos);
                mesh.userData = { id: index, station: station };
                mesh.lookAt(new THREE.Vector3(0,0,0)); 
                
                group.add(mesh);
                stationMeshes.push(mesh);
            });
            
            globe.add(group); // Add stations to globe so they rotate with it
        }

        // --- Math Helper ---
        function latLongToVector3(lat, lon, radius) {
            const phi = (90 - lat) * (Math.PI / 180);
            const theta = (lon + 180) * (Math.PI / 180);

            const x = -(radius * Math.sin(phi) * Math.cos(theta));
            const z = (radius * Math.sin(phi) * Math.sin(theta));
            const y = (radius * Math.cos(phi));

            return new THREE.Vector3(x, y, z);
        }

        // --- Interaction ---
        function onMouseMove(event) {
            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;
            
            checkIntersection();
        }

        function onTouchStart(event) {
            if(event.touches.length > 0) {
                mouse.x = (event.touches[0].clientX / window.innerWidth) * 2 - 1;
                mouse.y = -(event.touches[0].clientY / window.innerHeight) * 2 + 1;
                checkIntersection();
                if(hoveredStation) onClick();
            }
        }

        function checkIntersection() {
            raycaster.setFromCamera(mouse, camera);
            const intersects = raycaster.intersectObjects(stationMeshes);

            if (intersects.length > 0) {
                document.body.style.cursor = 'pointer';
                const object = intersects[0].object;
                
                if (hoveredStation !== object) {
                    if (hoveredStation) hoveredStation.material.color.setHex(STATION_COLOR);
                    if (hoveredStation) hoveredStation.scale.set(1,1,1);
                    
                    hoveredStation = object;
                    hoveredStation.material.color.setHex(STATION_HOVER_COLOR);
                    hoveredStation.scale.set(2, 2, 2);
                }
            } else {
                document.body.style.cursor = 'default';
                if (hoveredStation) {
                    hoveredStation.material.color.setHex(STATION_COLOR);
                    hoveredStation.scale.set(1,1,1);
                    hoveredStation = null;
                }
            }
        }

        function onClick() {
            controls.autoRotate = false;
            
            if (hoveredStation) {
                playStation(hoveredStation.userData.station);
            }
        }

        function playStation(station) {
            currentStation = station;
            
            // UI Update
            playerPanel.classList.remove('hidden');
            playerPanel.classList.remove('translate-y-full');
            stationNameEl.innerText = station.name;
            stationLocEl.innerText = `${station.state || ''} ${station.country}`.trim() || "Unknown Location";
            stationTagsEl.innerText = station.tags || "Radio";
            errorMsg.classList.add('hidden');
            
            // Audio Logic
            audioPlayer.src = station.url_resolved || station.url;
            setLoading(true);
            
            audioPlayer.play().then(() => {
                setLoading(false);
                setIsPlaying(true);
            }).catch(e => {
                console.error("Playback error", e);
                setLoading(false);
                setIsPlaying(false);
                errorMsg.classList.remove('hidden');
            });
        }

        function togglePlay() {
            if (audioPlayer.paused) {
                audioPlayer.play();
                setIsPlaying(true);
            } else {
                audioPlayer.pause();
                setIsPlaying(false);
            }
        }

        function setLoading(loading) {
            if (loading) {
                iconPlay.classList.add('hidden');
                iconPause.classList.add('hidden');
                audioLoader.classList.remove('hidden');
            } else {
                audioLoader.classList.add('hidden');
            }
        }

        function setIsPlaying(playing) {
            isPlaying = playing;
            if (playing) {
                iconPlay.classList.add('hidden');
                iconPause.classList.remove('hidden');
            } else {
                iconPlay.classList.remove('hidden');
                iconPause.classList.add('hidden');
            }
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        function animate() {
            requestAnimationFrame(animate);
            controls.update();
            renderer.render(scene, camera);
        }
    </script>
</body>
</html>